var NepaliDateConversion = (function () {

    var data = {
        2000: [365, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2001: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2002: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2003: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2004: [365, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2005: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2006: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2007: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2008: [365, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 29, 31],
        2009: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2010: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2011: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2012: [365, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
        2013: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2014: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2015: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2016: [365, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
        2017: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2018: [365, 31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2019: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2020: [365, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
        2021: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2022: [365, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
        2023: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2024: [365, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
        2025: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2026: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2027: [365, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2028: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2029: [365, 31, 31, 32, 31, 32, 30, 30, 29, 30, 29, 30, 30],
        2030: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2031: [365, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2032: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2033: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2034: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2035: [365, 30, 32, 31, 32, 31, 31, 29, 30, 30, 29, 29, 31],
        2036: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2037: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2038: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2039: [365, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
        2040: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2041: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2042: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2043: [365, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
        2044: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2045: [365, 31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2046: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2047: [365, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
        2048: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2049: [365, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
        2050: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2051: [365, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
        2052: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2053: [365, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
        2054: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2055: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2056: [365, 31, 31, 32, 31, 32, 30, 30, 29, 30, 29, 30, 30],
        2057: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2058: [365, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2059: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2060: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2061: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2062: [365, 30, 32, 31, 32, 31, 31, 29, 30, 29, 30, 29, 31],
        2063: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2064: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2065: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2066: [365, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 29, 31],
        2067: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2068: [365, 31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2069: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2070: [365, 31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
        2071: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2072: [365, 31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2073: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2074: [365, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
        2075: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2076: [365, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
        2077: [366, 31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2078: [365, 31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
        2079: [365, 31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2080: [365, 31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
        2081: [366, 31, 31, 32, 32, 31, 30, 30, 30, 29, 30, 30, 30],
        2082: [365, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30],
        2083: [365, 31, 31, 32, 31, 31, 30, 30, 30, 29, 30, 30, 30],
        2084: [365, 31, 31, 32, 31, 31, 30, 30, 30, 29, 30, 30, 30],
        2085: [366, 31, 32, 31, 32, 30, 31, 30, 30, 29, 30, 30, 30],
        2086: [365, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30],
        2087: [366, 31, 31, 32, 31, 31, 31, 30, 30, 29, 30, 30, 30],
        2088: [365, 30, 31, 32, 32, 30, 31, 30, 30, 29, 30, 30, 30],
        2089: [365, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30],
        2090: [365, 30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30]
    };

    function _toYMD(date) {
        return {
            year: date.getFullYear(),
            month: date.getMonth() + 1,
            day: date.getDate()
        };
    }

    function _toNepali(date) {
        var baseDate = moment([1943, 3, 14]);
        var userDate = moment(date);
        var daysFromBase = userDate.diff(baseDate, 'd');
        var nepYear = 2000;
        var nepMonth = 1;
        var nepDay = 1;
        while (daysFromBase > 0) {
            var daysInMonth = data[nepYear][nepMonth];
            nepDay++;
            if (nepDay > daysInMonth) {
                nepMonth++;
                nepDay = 1;
            }
            if (nepMonth > 12) {
                nepYear++;
                nepMonth = 1;
            }
            daysFromBase--;
        }
        return { year: nepYear, month: nepMonth, day: nepDay };
    }

    function _toGregorian(userDate) {
        var daysFromBase = 0;
        for (var y = 2000; y < userDate.year; y++) {
            daysFromBase += data[y][0];
        }
        for (var m = 1; m < userDate.month; m++) {
            daysFromBase += data[userDate.year][m];
        }
        daysFromBase += (userDate.day - 1);
        var baseDate = moment([1943, 3, 14]);
        baseDate.add(daysFromBase, 'd');
        return baseDate.toDate();
    }

    return {
        toNepali: _toNepali,
        toEnglish: _toGregorian,
        toYMD: _toYMD
    }

})();